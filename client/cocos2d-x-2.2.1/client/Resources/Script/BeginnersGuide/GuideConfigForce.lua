------------------------------------------------------------------------ 作者: jaron.ho-- 日期: 2014-08-27-- 描述: 新手强制引导------------------------------------------------------------------------[[引导组处理句柄结构	{		config: 引导步骤配置		ui_condition: nil,表示战斗引导;非nil,表示界面引导,当条件相等时才引导		copy_id: 该引导的副本限制					当ui_condition为nil时,只有进入的副本id和此值一样时才触发引导					当ui_condition非nil时,只有最后通关的副本id大于此值时才引导		relate_guide: 关联的引导组,如果本组要执行,则必须先执行关联组	}]]--[[引导步骤配置表结构	{		cmd: 引导命令		param: 参数(parent_name,根节点名;node_name,节点名称;grid_id,格子id;width,宽度;height,高度;x,横坐标;y,纵坐标;index,索引;flag,标识,percent,百分比;time,延迟时间)		lock: 操作类型(1,只能点击指定区域;2,可点击全屏;3,事件可穿透)		root_tag: 根节点标签		msg: 等待消息		direct: 箭头方向("up", "down", "left", "right")		funcs: 函数列表(用于某些参数值的动态获取,如:node_name=f1,则表示此参数值是通过函数funs.f1来获得)	}]]------------------------------------------------------------------------------------------------ 第0组:创建角色前引导----------------------------------------------------------------------GuideForce_Preview = {	["id"]				= 0,	["ui_condition"]	= nil,	["copy_id"]			= FIRSTCOPYID,	["relate_guide"]	= nil,    ["is_gone_masklayer"] = true,	["config"]			= 	{        --{cmd = "tap_gridList", 	param = "grid_id=8", 				                lock = 1},        --{cmd = "tap_gridList", 		param = "grid_id=8", 				                lock = 1},        --步骤1        {cmd = "battleDialog", 	param = "dialog_id=5001", 			    lock = 2},--3        --步骤2        {cmd = "summon",        param = "monsterId=61,amount=6", 	                lock = 2},        --步骤3        {cmd = "delay",        param = "time=1.5", 	                                lock = 2},        --步骤4        {cmd = "battleDialog", 	param = "dialog_id=5002", 			    lock = 2},--3        --步骤5        {cmd = "tap_skill", 	param = "skill_id=1", 				                lock = 1},        --步骤6        {cmd = "delay",        param = "time=4.5", 	                                lock = 2},        --步骤7        {cmd = "battleDialog", 	param = "dialog_id=5003", 			    lock = 2},--3        --步骤8        {cmd = "summon",        param = "monsterId=61,amount=6", 	                lock = 2},				--步骤9        {cmd = "delay",        param = "time=1", 	                                lock = 2},        --步骤10        {cmd = "battleDialog", 	param = "dialog_id=5004", 			    lock = 2},--3        --步骤11        {cmd = "tap_gridList", 		param = "grid_id=8", 				                lock = 1},        --步骤12        {cmd = "delay",        param = "time=1", 	                                lock = 2},        --步骤13        {cmd = "battleDialog", 	param = "dialog_id=5005", 			    lock = 2},--3        --步骤14        {cmd = "tap_skill", 	param = "skill_id=2,self=1", 				                lock = 1},        --步骤15        {cmd = "delay", 	    param = "time=0.5", 				                lock = 2},        --步骤16        {cmd = "tap_gridList", 		param = "grid_id=8,self=1", 				                lock = 1},        --步骤17        {cmd = "delay",        param = "time=1", 	                                lock = 2},	    	--步骤18        {cmd = "battleDialog", 	param = "dialog_id=5006", 			    lock = 2},--3        --步骤19        {cmd = "tap_skill", 	param = "skill_id=1", 				                lock = 1},        --步骤20        {cmd = "delay",        param = "time=4.5", 	                                lock = 2},        --步骤21        {cmd = "battleDialog", 	param = "dialog_id=5007", 			    lock = 2},--3        --步骤22        {cmd = "summon",        param = "monsterId=61,amount=6", 	                lock = 2},        --步骤23        {cmd = "delay",        param = "time=1", 	                                lock = 2},        --步骤24        {cmd = "battleDialog", 	param = "dialog_id=5008", 			                lock = 2},--3        --步骤25        {cmd = "tap_skill", 	param = "skill_id=3,self=1", 				                lock = 1},        --步骤27        {cmd = "delay",        param = "time=0.5", 	                                lock = 2},        --步骤28        {cmd = "battleDialog", 	param = "dialog_id=5009", 			                lock = 2},--3        --步骤29        {cmd = "tap_skill", 	param = "skill_id=4", 				                lock = 1},        --步骤30        {cmd = "delay",        param = "time=3", 	                                lock = 2},        --步骤301        {cmd = "tap_grid", 		param = "grid_id=28", 				lock = 1, msg="empty"},	},}function GuideForce_Preview.guideStart()	GuideBattleEngine.guideStart(GuideForce_Preview)end------------------------------------------------------------------------------------------------ 第1组:剧情铺垫----------------------------------------------------------------------GuideForce_ShowStory = {	["ui_condition"]	= {"ui_main"},	["copy_id"]			= 1,	["relate_guide"]	= nil,	["config"]			= 	{		{cmd = "talk", 			param = "", 												lock = 2},		{cmd = "talk", 			param = "", 												lock = 2},	},}function GuideForce_ShowStory.guideStart()	GuideUIEngine.guideStart(GuideForce_ShowStory, true)end------------------------------------------------------------------------------------------------ 第2组:剧情铺垫让玩家进入副本,进行选择副本1-1----------------------------------------------------------------------GuideForce_EnterCopy_1_1 = {	["ui_condition"]	= {"ui_main"},	["copy_id"]			= 1,	["relate_guide"]	= nil,	["config"]			= 	{		{cmd = "click_btn",		param = "parent_name=Panel_main_enter,node_name=Panel_mission_build",	lock = 1},		{cmd = "click_btn",		param = "parent_name=panel,node_name=group_1",				lock = 1,	direct = "left", msg = "ui_copynormal"},		{cmd = "click_btn",		param = "parent_name=panel,node_name=copy_btn_1",			lock = 1,	direct = "left"},		{cmd = "click_btn",		param = "parent_name=CopyInfoPanel,node_name=Button_sure",	lock = 1,	root_tag = "UI_CopyTips"},	},}function GuideForce_EnterCopy_1_1.guideStart()	GuideUIEngine.guideStart(GuideForce_EnterCopy_1_1, true)end------------------------------------------------------------------------------------------------ 第3组:学会基础操作和战斗----------------------------------------------------------------------GuideForce_BaseBattle = {	["ui_condition"]	= nil,	["copy_id"]			= 1001,	["relate_guide"]	= GuideForce_EnterCopy_1_1,	["config"]			= 	{		{cmd = "talk", 			param = "", 												lock = 2},		{cmd = "talk", 			param = "width=160,height=50,x=405,y=935",					lock = 2},		{cmd = "tap_grid", 		param = "grid_id=7",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=7",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=7",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=8",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=9",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=9",										lock = 1},		{cmd = "talk", 			param = "", 												lock = 2},		{cmd = "talk", 			param = "width=420,height=45,x=425,y=135",					lock = 2},		{cmd = "tap_skill", 	param = "skill_id=1", 										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=9",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=12",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=17",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=18",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=18",										lock = 1},		{cmd = "talk", 			param = "", 												lock = 2},		{cmd = "tap_grid", 		param = "grid_id=19",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=19",										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=20",										lock = 1},		{cmd = "tap_skill", 	param = "skill_id=1", 										lock = 1},		{cmd = "tap_grid", 		param = "grid_id=9",										lock = 1},		{cmd = "talk", 			param = "", 												lock = 2},		{cmd = "tap_grid", 		param = "grid_id=6",										lock = 1,	msg = "msg_notify_game_settle"},	},}function GuideForce_BaseBattle.guideStart()	GuideBattleEngine.guideStart(GuideForce_BaseBattle)end------------------------------------------------------------------------------------------------ 第4组:进行选择副本1-2----------------------------------------------------------------------GuideForce_EnterCopy_1_2 = {	["ui_condition"]	= {"ui_main", "ui_copynormal"},	["copy_id"]			= 1,	["relate_guide"]	= nil,}function GuideForce_EnterCopy_1_2.guideStart(condition)	if "ui_main" == condition then		GuideForce_EnterCopy_1_2["config"] = 		{			{cmd = "click_btn",		param = "parent_name=Panel_main_enter,node_name=Panel_mission_build",	lock = 1},			{cmd = "click_btn",		param = "parent_name=panel,node_name=group_1",				lock = 1,	direct = "left", msg = "ui_copynormal"},			{cmd = "talk",			param = "",													lock = 2},			{cmd = "click_btn",		param = "parent_name=panel,node_name=copy_btn_2",			lock = 1,	direct = "right"},			{cmd = "click_btn",		param = "parent_name=CopyInfoPanel,node_name=Button_sure",	lock = 1,	root_tag = "UI_CopyTips"},		}	elseif "ui_copynormal" == condition then		GuideForce_EnterCopy_1_2["config"] = 		{			{cmd = "none"},			{cmd = "none"},			{cmd = "talk",			param = "",													lock = 2},			{cmd = "click_btn",		param = "parent_name=panel,node_name=copy_btn_2",			lock = 1,	direct = "right"},			{cmd = "click_btn",		param = "parent_name=CopyInfoPanel,node_name=Button_sure",	lock = 1,	root_tag = "UI_CopyTips"},		}	end	GuideUIEngine.guideStart(GuideForce_EnterCopy_1_2, true)end------------------------------------------------------------------------------------------------ 第5组:引导使用【加血技能】----------------------------------------------------------------------GuideForce_UseAddBloodSkill = {	["ui_condition"]	= nil,	["copy_id"]			= 1002,	["relate_guide"]	= GuideForce_EnterCopy_1_2,	["config"]			= 	{		{cmd = "hurt",			param = "percent=80",										lock = 4},		{cmd = "talk", 			param = "", 												lock = 2},		{cmd = "skill_lock",	param = "index=2,flag=false"},		{cmd = "tap_skill", 	param = "skill_id=2", 										lock = 1},		{cmd = "talk", 			param = "width=150,height=160,x=75,y=80", 					lock = 2},		{cmd = "talk", 			param = "", 												lock = 2},		{cmd = "wait_msg", 		param = "",													lock = 4,	msg = "msg_notify_game_settle"},	},}function GuideForce_UseAddBloodSkill.guideStart()	GuideBattleEngine.guideStart(GuideForce_UseAddBloodSkill)end------------------------------------------------------------------------------------------------ 第6组:引导魔石占卜获得【技能碎片】----------------------------------------------------------------------GuideForce_DivineSkillFrag = {	["ui_condition"]	= {"ui_main"},	["copy_id"]			= 1002,	["relate_guide"]	= nil,	["config"]			= 	{		{cmd = "wait_msg",		param = "",														lock = 4,	msg = "click_copy_delock"},		{cmd = "click_btn",		param = "parent_name=panel,node_name=mainbtn_rune",			lock = 1,	msg = "ui_rune"},		{cmd = "talk",			param = "",														lock = 2},		{cmd = "click_btn",		param = "parent_name=Panel_20,node_name=ImageView_specialOpen",	lock = 1},		{cmd = "click_btn",		param = "parent_name=Panel_20,node_name=ImageView_specialOne",	lock = 1,	msg = "msg_notify_sculpture_divine"},	},}-- 开启function GuideForce_DivineSkillFrag.guideStart(condition)	GuideUIEngine.guideStart(GuideForce_DivineSkillFrag, true)end------------------------------------------------------------------------------------------------ 第7组:引导【技能解锁】----------------------------------------------------------------------function GuideConfig_getSkillInfo()	local roleType = ModelPlayer.getRoleType()	local skillIds = {108600, 110100, 117600, 128600}	for key, val in pairs(skillIds) do		local skillInfo = SkillConfig.getSkillInfo(val)		if roleType == skillInfo.role_type then			return skillInfo		end	endendGuideForce_DivineSkillUnlock = {	["ui_condition"]	= {"ui_main", "ui_runeshow"},	["copy_id"]			= 1002,	["relate_guide"]	= nil,}-- 开启function GuideForce_DivineSkillUnlock.guideStart(condition)	local skillInfo = GuideConfig_getSkillInfo()	local function func1()		LayerSkillMain.setTag(skillInfo.attribute_tag)		return LayerSkillMain.getWidgetNameBySkillGroup(skillInfo.skill_group)	end	if "ui_main" == condition then		GuideForce_DivineSkillUnlock["config"] = 		{			{cmd = "none"},			{cmd = "none"},			{cmd = "none"},			{cmd = "none"},			{cmd = "click_btn",		param = "parent_name=Panel_main_enter,node_name=Panel_inscription_build",	lock = 1,	msg = "ui_skillmain"},			{cmd = "click_btn", 	param = "parent_name=ScrollView_list,node_name=f1",	funcs = {f1=func1},	lock = 1,	msg = "ui_skillunlock"},			{cmd = "click_btn", 	param = "parent_name=SkillUnlockPanel,node_name=Button_unlock",	lock = 1,	msg = "msg_notify_sculpture_unlock",	root_tag = "UI_SkillUnlock"},		}	elseif "ui_runeshow" == condition then		GuideForce_DivineSkillUnlock["config"] = 		{			{cmd = "talk",			param = "",														lock = 2},			{cmd = "click_btn",		param = "parent_name=Panel_439,node_name=Button_close",	lock = 1, root_tag = "UI_RuneShow"},			{cmd = "click_btn",		param = "parent_name=Panel_20,node_name=ImageView_close",			lock = 1},			{cmd = "click_btn", 	param = "parent_name=panel,node_name=mainbtn_main", 			lock = 1},			{cmd = "click_btn",		param = "parent_name=panel,node_name=Panel_inscription_build",	lock = 1,	msg = "ui_skillmain"},			{cmd = "click_btn", 	param = "parent_name=ScrollView_list,node_name=f1",	funcs = {f1=func1},	lock = 1,	msg = "ui_skillunlock"},			{cmd = "click_btn", 	param = "parent_name=SkillUnlockPanel,node_name=Button_unlock",	lock = 1,	msg = "msg_notify_sculpture_unlock",	root_tag = "UI_SkillUnlock"},		}	end	GuideUIEngine.guideStart(GuideForce_DivineSkillUnlock, true)end------------------------------------------------------------------------------------------------ 第8组:引导【技能穿戴】----------------------------------------------------------------------GuideForce_DivineSkillEquip = {	["ui_condition"]	= {"ui_main", "ui_skilldevelop"},	["copy_id"]			= 1002,	["relate_guide"]	= nil,}-- 开启function GuideForce_DivineSkillEquip.guideStart(condition)	local skillInfo = GuideConfig_getSkillInfo()	local function func1()		LayerSkillMain.setTag(skillInfo.attribute_tag)		return LayerSkillMain.getWidgetNameBySkillGroup(skillInfo.skill_group)	end	local function func2()		return LayerSkillEquip.getWidgetNameBySkillGroup(skillInfo.skill_group)	end	if "ui_main" == condition then		GuideForce_DivineSkillEquip["config"] = 		{			{cmd = "click_btn",		param = "parent_name=Panel_main_enter,node_name=Panel_inscription_build",	lock = 1,	msg = "ui_skillmain"},			{cmd = "click_btn",		param = "parent_name=ScrollView_list,node_name=f1", funcs = {f1=func1},	lock = 1,	msg = "ui_skilldevelop"},			{cmd = "click_btn",		param = "parent_name=SkillDevelopPanel,node_name=Button_1081",	lock = 1,	msg = "ui_skillequip"},			{cmd = "click_btn",		param = "parent_name=ScrollView_list,node_name=f2", funcs = {f2=func2},	lock = 1,	msg = "ui_skillputon"},			{cmd = "click_btn",		param = "parent_name=SkillPutonPanel,node_name=Button_pos3", lock = 1,	msg = "msg_notify_sculpture_puton", root_tag = "UI_SkillPuton"},		}	elseif "ui_skilldevelop" == condition then		GuideForce_DivineSkillEquip["config"] = 		{			{cmd = "none"},			{cmd = "none"},			{cmd = "click_btn",		param = "parent_name=SkillDevelopPanel,node_name=Button_1081",	lock = 1,	msg = "ui_skillequip"},			{cmd = "click_btn",		param = "parent_name=ScrollView_list,node_name=f2", funcs = {f2=func2},	lock = 1,	msg = "ui_skillputon"},			{cmd = "click_btn",		param = "parent_name=SkillPutonPanel,node_name=Button_pos3", lock = 1,	msg = "msg_notify_sculpture_puton", root_tag = "UI_SkillPuton"},		}	end	GuideUIEngine.guideStart(GuideForce_DivineSkillEquip, true)end------------------------------------------------------------------------------------------------ 第9组:进行选择副本1-3----------------------------------------------------------------------GuideForce_EnterCopy_1_3 = {	["ui_condition"]	= {"ui_main", "ui_skillequip"},	["copy_id"]			= 1,	["relate_guide"]	= nil,}function GuideForce_EnterCopy_1_3.guideStart(condition)	if "ui_main" == condition then		GuideForce_EnterCopy_1_3["config"] = 		{			{cmd = "none"},			{cmd = "click_btn",		param = "parent_name=Panel_main_enter,node_name=Panel_mission_build",	lock = 1},			{cmd = "click_btn",		param = "parent_name=panel,node_name=group_1",				lock = 1,	direct = "left", msg = "ui_copynormal"},			{cmd = "talk",			param = "",													lock = 2},			{cmd = "click_btn",		param = "parent_name=panel,node_name=copy_btn_3",			lock = 1,	direct = "left"},			{cmd = "click_btn",		param = "parent_name=CopyInfoPanel,node_name=Button_sure",	lock = 1,	root_tag = "UI_CopyTips"},		}	elseif "ui_skillequip" == condition then		GuideForce_EnterCopy_1_3["config"] = 		{			{cmd = "click_btn", 	param = "parent_name=panel,node_name=mainbtn_main", 		lock = 1},			{cmd = "click_btn",		param = "parent_name=Panel_main_enter,node_name=Panel_mission_build",	lock = 1},			{cmd = "click_btn",		param = "parent_name=panel,node_name=group_1",				lock = 1,	direct = "left", msg = "ui_copynormal"},			{cmd = "talk",			param = "",													lock = 2},			{cmd = "click_btn",		param = "parent_name=panel,node_name=copy_btn_3",			lock = 1,	direct = "left"},			{cmd = "click_btn",		param = "parent_name=CopyInfoPanel,node_name=Button_sure",	lock = 1,	root_tag = "UI_CopyTips"},		}	end	GuideUIEngine.guideStart(GuideForce_EnterCopy_1_3, true)end------------------------------------------------------------------------------------------------ 第10组:引导使用【群攻技能】----------------------------------------------------------------------GuideForce_UseGroupAttackSkill = {	["ui_condition"]	= nil,	["copy_id"]			= 1003,	["relate_guide"]	= GuideForce_EnterCopy_1_3,	["config"]			= 	{		{cmd = "talk", 			param = "", 												lock = 2},		{cmd = "talk", 			param = "", 												lock = 2},		{cmd = "tap_skill", 	param = "skill_id=3", 										lock = 1},		{cmd = "touch",			param = "", 												lock = 3},		{cmd = "talk", 			param = "", 												lock = 2},		{cmd = "wait_msg", 		param = "",													lock = 4,	msg = "msg_notify_game_settle"},	},}function GuideForce_UseGroupAttackSkill.guideStart()	GuideBattleEngine.guideStart(GuideForce_UseGroupAttackSkill)end------------------------------------------------------------------------------------------------ 第11组:引导【穿戴装备】----------------------------------------------------------------------GuideForce_DressEquip = {	["ui_condition"]	= {"ui_main", "ui_copynormal"},	["copy_id"]			= 1003,	["relate_guide"]	= nil,	["config"]			= 	{		{cmd = "click_btn",		param = "parent_name=panel,node_name=mainbtn_hero",			lock = 1,	msg = "ui_backpack"},		{cmd = "click_btn",		param = "parent_name=Panel_1217,node_name=Button_Equip",	lock = 1},		{cmd = "click_btn",		param = "parent_name=Panel_Bag,node_name=grid_1",			lock = 1,	msg = "click_bag_grid"},		{cmd = "click_btn",		param = "parent_name=Panel_equip_no_put,node_name=Button_put",		lock = 1,	root_tag = "UI_Equip_Noput"},	},}-- 开启function GuideForce_DressEquip.guideStart()	GuideUIEngine.guideStart(GuideForce_DressEquip, true)end------------------------------------------------------------------------------------------------ 第12组:进行选择副本1-4----------------------------------------------------------------------GuideForce_EnterCopy_1_4 = {	["ui_condition"]	= {"ui_main", "ui_bagequip"},	["copy_id"]			= 1003,	["relate_guide"]	= nil,}-- 开启function GuideForce_EnterCopy_1_4.guideStart(condition)	if "ui_main" == condition then		GuideForce_EnterCopy_1_4["config"] = 		{			{cmd = "none"},			{cmd = "click_btn",		param = "parent_name=Panel_main_enter,node_name=Panel_mission_build",	lock = 1},			{cmd = "delay", 		param = "time=0.05", 										lock = 2},			{cmd = "talk", 			param = "", 												lock = 2},		}	elseif "ui_bagequip" == condition then		GuideForce_EnterCopy_1_4["config"] = 		{			{cmd = "talk", 			param = "", 												lock = 2},			{cmd = "click_btn", 	param = "parent_name=panel,node_name=mainbtn_main", 		lock = 1},			{cmd = "click_btn",		param = "parent_name=Panel_main_enter,node_name=Panel_mission_build",	lock = 1},			{cmd = "talk", 			param = "", 												lock = 2},		}	end	GuideUIEngine.guideStart(GuideForce_EnterCopy_1_4, true)end----------------------------------------------------------------------