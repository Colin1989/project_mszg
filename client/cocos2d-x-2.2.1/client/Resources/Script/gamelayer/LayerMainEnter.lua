---------------------------------------作者：李慧琴--说明：主页入口界面--时间：2014-2-28-------------------------------------LayerMainEnter = {}local mLayerMainEnterRoot = nil -- 消息数量local m_tipsNum = 0-- label taglocal LabelTipsTag = 123-- times flagelocal m_bHasReqChallengeFlage = false--获得当前界面的根节点LayerMainEnter.getLayerRoot = function()	return  mLayerMainEnterRoot,"mLayerMainEnterRoot"end-- net reclocal function Handle_req_showGameRankMsgTips(resp)	cclog("netRec竞技场消息气泡:"..resp.times)	m_tipsNum = resp.times	LayerMainEnter.showGameRankMsgTips()endLayerMainEnter.getMsgTipsNum = function()	return m_tipsNumendLayerMainEnter.setReqChallengeFlage = function(b)	m_bHasReqChallengeFlage = b	LayerMainEnter.showGameRankMsgTips()endLayerMainEnter.setMsgTipsNum = function(num)	if (num <= 0) or (type(num) ~= "number") then		m_tipsNum = 0	else		m_tipsNum = num	end	LayerMainEnter.showGameRankMsgTips()end-- 推送消息regNetSocket_registerHandler(NetMsgType["msg_notify_be_challenged_times"], notify_be_challenged_times, Handle_req_showGameRankMsgTips)-- 显示竞技场提示LayerMainEnter.showGameRankMsgTips = function()	if nil == mLayerMainEnterRoot then		return	end		local jjcTipIcon = mLayerMainEnterRoot:getChildByName("Panel_jjc_build_tip")	if  tonumber(LIMIT_JJC.copy_id) ~= 1 and CopyDateCache.getCopyStatus(LIMIT_JJC.copy_id) ~= "pass" then		jjcTipIcon:setVisible(false)		return false	end		-- 训练赛获取是否还有礼包未领取	local b1 = LayerGameTrain.getIsRewardCanGet()	-- 排位赛获取奖励是否可以领取	local b2 = LayerGameRank.getIsRewardCanGet()	-- 排位赛消息数量	local b3 = (tonumber(m_tipsNum) > 0)	-- 军衔奖励是否可以领取	-- local b4 = MiltitaryLogic.existAward()	local b4 = false		-- 分组赛挑战次数	-- local b6 = ladderMatchfenzu.isShowTip()	local b6 = false		-- 竞技兑换是否可以兑换	-- local b7 = LayerCommodityConvert.isShowTip()	local b7 = false		-- 勋章是否可以强化或进阶	local b8 = LayerGameMedal.isStrengthShowTip()		-- 勋章是否可以强化	local b9 = LayerGameMedal.isUpgradeShowTip()		-- 勋章是否可以进阶		local xks = b1									 	-- 训练赛	local pws = b2 or b3								-- 排位赛消息和排位奖励	local fzs = b6  									-- 分组赛	local jjdh = false									-- 竞技兑换	local jxjl = b4 									-- 军衔奖励	local jjdx = b7    								-- 竞技兑换	local xzqh = b8 or b9								-- 勋章强化		local flg = xks or pws or fzs or jjdh or jxjl or jjdx or xzqh	if flg then		-- print("我要显示了***********************************",xks,pws,fzs,jjdh,jxjl,jjdx,xzqh)		jjcTipIcon:setVisible(true)	else		-- print("我要隐藏了***********************************",xks,pws,fzs,jjdh,jxjl,jjdx,xzqh)		jjcTipIcon:setVisible(false)	end	return flgend-- 显示技能提示LayerMainEnter.showSkillTip = function()	if nil == mLayerMainEnterRoot then		return false	end	local tagTb = SkillLogic.existUnlockAdvanceSkill()	local tipIcon = mLayerMainEnterRoot:getChildByName("Panel_inscription_build_tip")	tipIcon:setVisible(#tagTb > 0)	return #tagTb > 0end-- 显示活动提示LayerMainEnter.showActivityTip = function()	if nil == mLayerMainEnterRoot then		return	end		local activityTipIcon = mLayerMainEnterRoot:getChildByName("Panel_activity_build_tip")	if tonumber(LIMIT_ACTIVITY.copy_id) ~= 1 and  CopyDateCache.getCopyStatus(LIMIT_ACTIVITY.copy_id) ~= "pass" then		activityTipIcon:setVisible(false)		return false	end		local showFlag = false	if DailyAwardLogic.existAward() then			-- 签到奖励		showFlag = true	end	-- if DailyActivenessLogic.existAward() then		-- 每日活跃		-- showFlag = true	-- end	if LevelGiftLogic.existAward() then			-- 冲级活动		showFlag = true	end	if GetCoinLogic.existAward() then				-- 炼金术		showFlag = true	end	if OnlineRewardLogic.existAward() then			-- 在线奖励		showFlag = true	end	if DisResLogic.existAward() then				-- 打折限购		showFlag = true	end	if FirstRechargeLogic.existAward() then		-- 首充奖励		showFlag = true	end	-- if LayerChenallBoss.existAward() then			-- BOSS挑战		-- showFlag = true	-- end	-- if LayerTowerbg.existAward() then				-- 魔塔		-- showFlag = true	-- end	if LayerPowerHp.existAward() then				-- 领取体力		showFlag = true	end	activityTipIcon:setVisible(showFlag)	return showFlagend--显影潜能感叹号LayerMainEnter.showRoleUpTip = function()	if nil == mLayerMainEnterRoot then		return	end	local roleUpTipIcon = mLayerMainEnterRoot:getChildByName("Panel_public_build_tip")	local showFlag = false 	if LayerRoleUpPotent.getRoleUpable() == true and (CopyDateCache.getCopyStatus(LIMIT_HERO_UP_LEVEL.copy_id) == "pass") 		and  tonumber(LIMIT_HERO_UP_LEVEL.copy_id) ~= 1 then 		showFlag = true	end 	if LayerRoleTalent.getTip() == true and (CopyDateCache.getCopyStatus(LIMIT_TALENT.copy_id) == "pass") 		and  tonumber(LIMIT_TALENT.copy_id) ~= 1 then 		showFlag = true	end 	roleUpTipIcon:setVisible(showFlag)	--print("LayerMainEnter.showRoleUpTip*************",LayerRoleTalent.getTip(),showFlag,LayerRoleUpPotent.getRoleUpable())	return showFlagendfunction enterOtherScene(type,widget)	if type =="releaseUp" then		TipModule.onClick(widget)		if LayerMain.getCurStatus() ~= "mainbtn_main" then			--cclog("好混乱 为什么这也可以点击")			return		end		local widgetName = widget:getName()		CopyDelockLogic.setTipShow(mLayerMainEnterRoot,widgetName,"mLayerMainEnterRoot")		if widgetName == LayerMain.getCurStatus() then 			--cclog("?不管你是谁 都不要点太快啊")			return		end		if widgetName == "Panel_jjc_build" then					-- 竞技场			if  tonumber(LIMIT_JJC.copy_id) ~= 1 and CopyDateCache.getCopyStatus(LIMIT_JJC.copy_id) ~= "pass" then				Toast.Textstrokeshow(GameString.get("Public_Pass_Copy",CopyDelockLogic.showNumberFBQById(LIMIT_JJC.copy_id),LIMIT_JJC.fbName), ccc3(255, 255, 255), ccc3(0, 0, 0), 30)				return			end			setConententPannelJosn(LayerGameRankChoice, "GameRankChoice_1.json", widgetName)		elseif widgetName == "Panel_forge_build" then			-- 锻造			setConententPannelJosn(LayerSmithMain, "Smith_Main.json", widgetName)			 --setConententPannelJosn(LayerEquipForge, "EquipForgeMain_1.json", widgetName) 		elseif widgetName == "Panel_mission_build" then			-- 副本			setConententPannelJosn(LayerLevelSelcet, "CopyBackgournd_1.json", widgetName)		elseif widgetName == "Panel_inscription_build" then		-- 铭文大师			setConententPannelJosn(LayerSkillMain, "SkillMain.json", widgetName)		elseif widgetName == "Panel_public_build" then			-- 公会			setConententPannelJosn(LayerRoleUp, LayerRoleUp.jsonFile, widgetName)		elseif widgetName == "Panel_rankingList_build" then		-- 排行榜		    setConententPannelJosn(LayerRankLists, "RankLists_1.json", widgetName)		elseif widgetName == "Panel_activity_build" then			-- 活动大使			setConententPannelJosn(LayerActivity, "Activity.json", widgetName)		end	end	end--动态加载json文件--[[function  setOthenSceneJson(this,jsonfile)	local  panelContent = mLayerMainEnterRoot:getChildByName("Panel_mainenter")	tolua.cast(panelContent,"UILayout")	panelContent:removeAllChildren()		local contentView = GUIReader:shareReader():widgetFromJsonFile(jsonFile)	contentView:setAnchorPoint(ccp(0.0,0.0))	panelContent:addChild(contentView)	this.init(panelContent,contentView)end]]--local function reqChallengeTimes()	-- 训练赛挑战次数信息	EventCenter_post(EventDef["ED_TRAINGAME_TIMES"])	-- 排位赛挑战次数信息	EventCenter_post(EventDef["ED_RANKGAME_TIMES"])	-- 分组赛挑战次数信息	EventCenter_post(EventDef["ED_LADDERGAME_TIMES"])	-- 魔塔挑战次数信息	EventCenter_post(EventDef["ED_PUSHTOWER_TIMES"])endLayerMainEnter.init = function (RootView)	mLayerMainEnterRoot = RootView		local jjc = mLayerMainEnterRoot:getChildByName("Panel_jjc_build")								-- 竞技场	jjc:registerEventScript(enterOtherScene)	jjc:setTouchEnabled(true)		local auction = mLayerMainEnterRoot:getChildByName("Panel_forge_build")						-- 铸造	auction:registerEventScript(enterOtherScene) 	auction:setTouchEnabled(true)		local mission = mLayerMainEnterRoot:getChildByName("Panel_mission_build")						-- 历练	mission:registerEventScript(enterOtherScene)	mission:setTouchEnabled(true)		local inscription = mLayerMainEnterRoot:getChildByName("Panel_inscription_build")				-- 铭文大师     	inscription:registerEventScript(enterOtherScene)	inscription:setTouchEnabled(true)		local public = mLayerMainEnterRoot:getChildByName("Panel_public_build")						-- 公会	public:registerEventScript(enterOtherScene)	public:setEnabled(true)	public:setTouchEnabled(true)		local rankingList = mLayerMainEnterRoot:getChildByName("Panel_rankingList_build")				-- 排行榜	rankingList:registerEventScript(enterOtherScene)	rankingList:setTouchEnabled(true)		local activity = mLayerMainEnterRoot:getChildByName("Panel_activity_build")					-- 活动大使	activity:registerEventScript(enterOtherScene)	activity:setTouchEnabled(true)		if not m_bHasReqChallengeFlage then		reqChallengeTimes()	else		-- 更新竞技场推送消息气泡数量		LayerMainEnter.showGameRankMsgTips()	end	--[[	if nil == FriendDataCache.firstRequest() then		FriendDataCache.reqGetFriends_list()	end	]]--	LayerMainEnter.showActivityTip()	TipFunction.init()endLayerMainEnter.destroy = function()	mLayerMainEnterRoot = nil    LayerChenallBoss.destroy()    LayerTowerbg.destroy()end-- 游戏事件注册--活动EventCenter_subscribe(EventDef["ED_ROLETALENT"], LayerMainEnter.showRoleUpTip)		--天赋EventCenter_subscribe(EventDef["ED_UPDATE_ROLEUP_INFO"], LayerMainEnter.showRoleUpTip)		--潜能EventCenter_subscribe(EventDef["ED_UPDATE_SKILLPACK"], LayerMainEnter.showSkillTip)EventCenter_subscribe(EventDef["ED_DAILY_AWARD"], LayerMainEnter.showActivityTip)EventCenter_subscribe(EventDef["ED_ACTIVENESS_AWARD"], LayerMainEnter.showActivityTip)EventCenter_subscribe(EventDef["ED_LEVEL_GET_GIFT"], LayerMainEnter.showActivityTip)		--等级礼包（冲级）EventCenter_subscribe(EventDef["ED_GET_ONLINE_AWARD"], LayerMainEnter.showActivityTip)		--在线奖励EventCenter_subscribe(EventDef["ED_ONLINE_AWARD_INFO"], LayerMainEnter.showActivityTip)		--在线奖励EventCenter_subscribe(EventDef["ED_FIRSTR_ECHARGE_GET"], LayerMainEnter.showActivityTip)	--首充EventCenter_subscribe(EventDef["ED_ALCHEMY"], LayerMainEnter.showActivityTip)				--炼金EventCenter_subscribe(EventDef["ED_TOWER_INFO"], LayerMainEnter.showActivityTip)			--推塔EventCenter_subscribe(EventDef["ED_SUMMON_STONE"], LayerMainEnter.showActivityTip)			--Boss挑战EventCenter_subscribe(EventDef["ED_TIME_LIMIT_REWARD_LIST"], LayerMainEnter.showActivityTip)	-- 领取体力--竞技场EventCenter_subscribe(EventDef["ED_LADDER_MATCH_INFO"], LayerMainEnter.showGameRankMsgTips)			--分组赛信息EventCenter_subscribe(EventDef["ED_MILTITARY_RANK_GET_REWARD"], LayerMainEnter.showGameRankMsgTips)	--收到军衔排行信息