------------------------------------------------------------------------ 作者：shenl-- 日期：2013-12-09-- 描述：点击格子创建出的精灵工厂------------------------------------------------------------------------[[function GameSceneSprite:new(o)	o = o or {} 	setmetatable(o,self)	self.__index = self	return oend]]--FactoryGameSprite = {}-- 用plist 图片创建资源（不支持抠图）FactoryGameSprite.createSpriteByPlist = function(fileName)	local frame = CCSpriteFrameCache:sharedSpriteFrameCache():spriteFrameByName(fileName);	local sprite = CCSprite:createWithSpriteFrame(frame);	return spriteend--[[FactoryGameSprite.createNumberFont =function(num)	local bmFont = CCLabelBMFont:new()    bmFont:init()    bmFont:setFntFile("font-issue1343.fnt")    bmFont:setString(num)	bmFont:setScale(0.8)	return bmFontend]]------创建敌人（竞技场专属）  FactoryGameSprite.createEnemySprite = function(EnemyType)	local role_tplt = ModelPlayer.getRoleRow(EnemyType)	local role_Ani = ResourceManger.getAnimationFrameById(role_tplt.icon )	local mEnemyNode = CCSprite:create()		local str = string.format("%s_%s",role_Ani.name,role_Ani.wait).."_%03d.png"	--cclog("str",str)	local animation = createAnimation(str,role_Ani.wait_frame,0.1)	mEnemyNode:setAnchorPoint(ccp(0.5,0))	mEnemyNode:setFlipX(true)	mEnemyNode:setScale(1.0)	mEnemyNode:runAction(CCRepeatForever:create(CCAnimate:create(animation)))	return mEnemyNode,role_tplt.iconend----创建动作精灵  resId 怪物类型 标识资源类型FactoryGameSprite.createMonsterSprite = function(resid)	local role_Ani = ResourceManger.getAnimationFrameById(resid)	local str = string.format("%s_%s",role_Ani.name,role_Ani.wait).."_%03d.png"	local monster = createAnimation_forever(str,role_Ani.wait_frame,0.1)	monster:setAnchorPoint(ccp(0.5,0))	return monsterend-- 路障FactoryGameSprite.createBarrierPos = function(data)	local spBarrier = CCSprite:create("item3.png")	spBarrier:setAnchorPoint(ccp(0.0,0.0))	return spBarrierend-- 门DOORMASK = 1000 + 31	--门的精灵掩码FactoryGameSprite.createKeyInScene = function(GridId)	local key = CCSprite:create("key.png")	key:setAnchorPoint(ccp(0.5,0.5))	key:setTag(DOORMASK)	--key:setPosition(getTmxMapBackground():convertToWorldSpace(ccp(getRealSpritePosByGridId(GridId))));		local curPos = getTmxMapBackground():convertToWorldSpace(ccp(getRealSpritePosByGridId(GridId)))	 	local deltaPos = ccp(curPos.x + CELLSIZE_WIDTH/2,curPos.y + CELLSIZE_HEIGHT/2)	key:setPosition(deltaPos)	g_sceneRoot:addChild(key,g_Const_GameLayer.sceneChildLayer.sprite+30);	return keyend--创建门FactoryGameSprite.createDoorInScene = function(GridId)	local door = CCSprite:create("item1.png")	door:setAnchorPoint(ccp(0.0,0.0))	door:setTag(DOORMASK)	door:setPosition(getTmxMapBackground():convertToWorldSpace(ccp(getRealSpritePosByGridId(GridId))));	g_sceneRoot:addChild(door,g_Const_GameLayer.sceneChildLayer.sprite+GridId);		if CopyDateCache.GameType == "jjc" then		door:setVisible(false)	end endFactoryGameSprite.openDoor = function()	local door = g_sceneRoot:getChildByTag(DOORMASK)	--local str = string.format("%s_%s",role_Ani.name,role_Ani.wait).."_%03d.png"	local animation = createAnimation("door%02d.png",15,0.1)	door:runAction(CCRepeatForever:create(CCAnimate:create(animation)))end --创建下落物品local ITEM_FALL_DISTANCE = 50 function create_fall_item(GridId,itemRes,itemDisten)	local item = CCSprite:create(itemRes)	item:setTag(GridId+mSpriteMask)	item:setAnchorPoint(ccp(0.0,0.0))	local curPos = getTmxMapBackground():convertToWorldSpace(ccp(getRealSpritePosByGridId(GridId)))	 	local deltaPos = ccp(curPos.x,curPos.y + itemDisten) 	item:setPosition(deltaPos)	FightAnimation_drop(item,itemDisten)	g_sceneRoot:addChild(item,g_Const_GameLayer.sceneChildLayer.sprite+GridId);		return itemend-- 金币FactoryGameSprite.createGoldInScene = function(GridId,icon)	--可能金币动画不一样 先留着	local item = create_fall_item(GridId,icon,ITEM_FALL_DISTANCE)	Lewis:spriteShaderEffect(item, "item_tips.fsh", true)end-- 血瓶FactoryGameSprite.createBloodInScene = function(GridId,icon)	--可能血瓶动画不一样 先留着	local item = create_fall_item(GridId,icon,ITEM_FALL_DISTANCE)	Lewis:spriteShaderEffect(item, "item_tips.fsh", true)end-- 道具FactoryGameSprite.createItem = function(GridId,dropout_id,dropType)	if dropType == nil then 		create_fall_item(GridId,"monsterdeath.png",ITEM_FALL_DISTANCE)	-- 尸体	elseif dropType == "trap" then 		--create_fall_item(GridId,"item6.png",ITEM_FALL_DISTANCE)	-- 改变成动画 卧槽		local effect = createAnimation_signal("effect_000_%03d.png",12,0.1)				effect:setPosition(getTmxMapBackground():convertToWorldSpace(ccp( getRealSpritePosByGridId(GridId))));		effect:setAnchorPoint(ccp(0.35,0.15))		g_sceneRoot:addChild(effect,g_Const_GameLayer.sceneChildLayer.effect)	else		create_fall_item(GridId,"item4.png",ITEM_FALL_DISTANCE*2)		--宝箱 泛指道具	endend