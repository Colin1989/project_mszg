------------------------------------------------------------------------ 作者：lewis-- 日期：2013-04-11-- 描述：格子触摸事件层----------------------------------------------------------------------GridTouchEvent = {}local mRootView = nillocal mIsLongPress = falselocal mGridId = 0local function onTouch(eventType, x, y)	if eventType == "began" then		mGridId = 0        local result = GridTouchEvent.touchBegan(x, y)		return result	elseif eventType == "moved" then	else		return GridTouchEvent.touchEnded(x, y)	endend--创建function GridTouchEvent.create(root)	mRootView = CCLayer:create()	root:addChild(mRootView)	mRootView:registerScriptTouchHandler(onTouch,false,128,false)	mRootView:setTouchEnabled(true)endlocal function longPress(sender)	if mIsLongPress then return end	mIsLongPress = true	if FightConfig.getConfig("enable_long_press") == false then return end	GridMgr.onPress(mGridId)end--触摸事件开始function GridTouchEvent.touchBegan(x, y)    if FightMgr.isOnControll() == false then         return false     end	mIsLongPress = false	if FightConfig.getConfig("enable_long_press") == false then 		GridTouchEvent.touchEnded(x, y)		return false	end	local rect = GridMgr.getConfig("gmc_map_rect")	if rect == nil then return false end	if rect:containsPoint(ccp(x, y)) == false then return false end		mGridId = GridMgr.posToGridId(x, y)	mRootView:stopAllActions()	local arr = CCArray:create()	arr:addObject(CCDelayTime:create(0.55))	arr:addObject(CCCallFuncN:create(longPress))	mRootView:runAction(CCSequence:create(arr))	return trueend--触摸结束事件function GridTouchEvent.touchEnded(x, y)	if mIsLongPress then return end	mIsLongPress = true	if FightMgr.isPlayerOnControll() == false then return end	if GridMgr.isTouchEnable() == false then		return	end	local rect = GridMgr.getConfig("gmc_map_rect")	if rect:containsPoint(ccp(x, y)) == false then return end		local idx = GridMgr.posToGridId(x, y)	GridMgr.setConfig("gmc_touch_effect", true)	GridMgr.onTap(idx)    GridMgr.resetTimer()	if GridMgr.getConfig("gmc_touch_effect") == false then		GridTouchEvent.showUnTouchableTips(ccp(x, y))	endend--移除自身local function removeSelf(sender)	sender:removeFromParentAndCleanup(true)end--不可点击提醒function GridTouchEvent.showUnTouchableTips(pos)	local batchNode = GridMgr.getConfig("touch_disable_layer")	local sprite = CCSprite:createWithTexture(batchNode:getTexture())	sprite:setPosition(pos)	batchNode:addChild(sprite)		sprite:setOpacity(255)	sprite:setScale(0.5)	sprite:runAction(CCSequence:createWithTwoActions(CCScaleTo:create(0.15, 2.2), CCCallFuncN:create(removeSelf)))	sprite:runAction(CCFadeTo:create(0.15, 0))end