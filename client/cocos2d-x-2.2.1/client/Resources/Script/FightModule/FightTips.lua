------------------------------------------------------------------------ 作者: lewis hamilton-- 日期: 2014-05-3-- 描述: 战斗信息提示----------------------------------------------------------------------FightTips = {}local function localPrint(...)	if true then return end	lewisPrint("FightTips", ...)endlocal mDelayTime = 0.0local mLayer = nil--踩陷阱触发function FightTips.trap(name)	local content, color = FightTips.getFightTips(1)	local text = string.format(content, name)	FightTips.showText1(text, name, 1)end--金冠怪触发function FightTips.scaryMonster(name, mType)	if mType ~= 2 or mType ~= 3 then		return	end	local content, color = FightTips.getFightTips(2)	local text = string.format(content, name)	FightTips.showText1(text, name, color)end--被怪物杀死function FightTips.killByMonster(name)	local content, color = FightTips.getFightTips(3)	local text = string.format(content, name)	FightTips.showText1(text, name, color)end--杀死怪物function FightTips.killMonster(name)	local content, color = FightTips.getFightTips(7)	local text = string.format(content, name)	FightTips.showText1(text, name, color)end--怪物逃跑function FightTips.monsterEscape(name)end--玩家受buff or debufffunction FightTips.playerOnbuff(idx, name, buffType)	if idx == 0 then		return	end	local content, color = FightTips.getFightTips(idx)	--local posName = string.find(content, "%s")	--if posName then content = string.format(content, name) end	content = string.format(content, name)	FightTips.showText1(content, name, buffType)end--function FightTips.init()	mDelayTime = 0.0	mLayer = CCLayer:create()	g_rootNode:addChild(mLayer, 10000)endlocal FLY_TIME = 2.0local function CBShow(sender)	sender:setVisible(true)endlocal function CBDelete(sender)	sender:getParent():removeChild(sender, true)	mDelayTime = mDelayTime - FLY_TIMEendfunction FightTips.showText1(text, keywords, color)	local preText = nil	local behindTex = nil		local posName = string.find(text, keywords)	if (not posName) then		preText = text	else		preText = string.sub(text, 1, posName - 1)		behindTex = string.sub(text, posName + #keywords, -1)	end	--if preText ~= nil then localPrint(preText) end	--localPrint(keywords)	--if behindTex ~= nil then localPrint(behindTex) end	local layer = CCLayer:create()    local parentRoot =	EffectMgr.getConfig("emc_font_tips_layer")	parentRoot:addChild(layer)		local totalWidth = 0	if preText ~= nil then		local width = FightTips.showText(layer, preText, ccp(0, 0), FightTips.getColor(1))		totalWidth = width	end		if keywords ~= nil then		width = FightTips.showText(layer, keywords, ccp(totalWidth, 0), FightTips.getColor(color + 1))		totalWidth = totalWidth + width	end		if behindTex ~= nil then		width = FightTips.showText(layer, behindTex, ccp(totalWidth, 0), FightTips.getColor(1))		totalWidth = totalWidth + width	end		local bg = CCScale9Sprite:create("sysmsg.png")	layer:addChild(bg)	local size = CCSizeMake(totalWidth + 10, 32)	bg:setCapInsets(CCRectMake(15,15,10,10))	bg:setPreferredSize(size)	bg:setAnchorPoint(ccp(0.5,0.5))	bg:setPosition(ccp(size.width / 2, 0))		layer:setPosition(ccp((720 - totalWidth) / 2, 720))	local arr = CCArray:create()	arr:addObject(CCDelayTime:create(mDelayTime))	arr:addObject(CCCallFuncN:create(CBShow))    arr:addObject(CCDelayTime:create(FLY_TIME * 1.0))	--arr:addObject(CCMoveBy:create(FLY_TIME * 0.1, CCPointMake(0, 120)))	arr:addObject(CCCallFuncN:create(CBDelete))	layer:runAction(CCSequence:create(arr))	layer:setVisible(false)	mDelayTime = mDelayTime + FLY_TIME		end	function FightTips.showText(layer, text, position, color)	local label = CCLabelTTF:new()    label:init()    label:autorelease()    label:setFontName("fzzdh.TTF")    label:setFontSize(28)	label:setPosition(position)	label:setAnchorPoint(ccp(0, 0.5))	label:setString(text)	label:setColor(color)	layer:addChild(label, 1)	label:runAction(CCSequence:createWithTwoActions(CCDelayTime:create(mDelayTime + FLY_TIME * 0.7), CCFadeTo:create(FLY_TIME * 0.3, 0)))	--Lewis:spriteShaderEffect(label, "font_stroke.fsh", true)	return label:getContentSize().widthend--文件名:fight_tips_tplt.xml--字段一:id		(id)--字段二:content (内容)--字段三:color　(关键字颜色,默认白色)(0,白色)(1,红色)(2,绿色)(3,蓝色)--buff表增加一个字段: tips_idlocal mFightTipsTable = XmlTable_load("fight_tips_tplt.xml", "id")function FightTips.getFightTips(id)	local row = XmlTable_getRow(mFightTipsTable, id, true)	return row.content, row.colorendlocal colorVec = {ccc3(255, 255, 255), ccc3(0, 255, 0), ccc3(255, 0, 0), ccc3(0, 0, 255)}function FightTips.getColor(idx)	return colorVec[idx]end