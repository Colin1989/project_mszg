------------------------------------------------------------------------ 作者：lewis-- 日期：2013-4-24-- 描述：游戏场景,管理所有layer----------------------------------------------------------------------GameScene = {}local mConfigTB = {}--移除自身local function removeSelf(sender)	if sender == nil then return end	sender:removeFromParentAndCleanup(true)endfunction GameScene.init()	GameScene.initConfig()endfunction GameScene.cleanup()	removeSelf(GameScene.getConfig("player_root_view"))	LayerGameUI.destroy()	mConfigTB = {}	g_sceneRoot:removeAllChildrenWithCleanup(true)	g_sceneRoot:setVisible(true)end-----------------------------------------------------------------------------------------------------------配置数据----------------------------------------------------------------------------------------------------------------初始化配置数据function GameScene.initConfig()	mConfigTB = {}	mConfigTB["map_root_view"]			= nil		--地图层根结点	mConfigTB["player_root_view"]		= nil		--技能end--获得数据function GameScene.getConfig(name)	local ret = mConfigTB[name]	return retend--设置数据function GameScene.setConfig(name, value)	mConfigTB[name] = valueend--资源加载前function GameScene.beforLoading()	LayerGameUI.show(false)	local layer = GameScene.getConfig("player_root_view")	layer:setVisible(false)end--资源加载完毕function GameScene.afterLoading()	LayerGameUI.show(true)	local layer = GameScene.getConfig("player_root_view")	layer:setVisible(true)end--全局视图function GameScene.createGameUI()	--主游戏UI	LayerGameUI.initView()		local root = CCLayer:create()	g_sceneUIRoot:addChild(root, 1000)	GameScene.setConfig("player_root_view", root)		--玩家角色视图层	local layer = CCLayer:create()	root:addChild(layer)	RoleMgr.setConfig("rmc_player_parent_layer", layer)		--玩家按钮层	local layer = UILayer:create()	root:addChild(layer)	RoleMgr.setConfig("rmc_player_skill_btn_layer", layer)		--技能前景特效层	local layer = CCLayer:create()	root:addChild(layer)	EffectMgr.setConfig("emc_front_layer", layer)    --文字提示层	local layer = CCLayer:create()	root:addChild(layer)	EffectMgr.setConfig("emc_font_tips_layer", layer)		--伤害信息提示层	local layer = CCLayer:create()	root:addChild(layer)	BattleMgr.setConfig("bmc_damage_layer", layer)	end--创建地图function GameScene.createMapScene()		g_sceneRoot:removeAllChildrenWithCleanup(true)	g_sceneRoot:setVisible(true)		local layer = CCLayer:create()	g_sceneRoot:addChild(layer)	GameScene.setConfig("map_root_view")		--创建地图层	MapView.create(layer)	GridMgr.closeDoor()		LayerGameUI.updateFloorInfo()	LayerGameUI.initMonsterCnt()	LayerGameUI.updateKeyCnt()	Audio.playBgMscByTag(1)--主战音乐		GameScene.playEnterGame()end--资源加载完后的一些初始化function GameScene.afterLoad()	--玩家角色视图	RoleMgr.createPlayer()	AssistanceViewController.create()	RoleMgr.createFriend()end--游戏开始前的一些特效function GameScene.playEnterGame()	local floorIdx = FightDateCache.getData("fd_floor_index")	if floorIdx > 1 then		FightMgr.battleStart()		return 	end		local mode = FightDateCache.getData("fd_game_mode")	if mode == 1 then		local effect = EffectMapName.new()		effect:setCallback(FightMgr.battleStart, nil)		effect:play()	elseif mode == 3 or mode == 4 then		local effect = EffectPVP.new()		effect:setCallback(FightMgr.battleStart, nil)		effect:play()    elseif mode == 5 then         local effect = EffectPVP33.new()		effect:setCallback(FightMgr.battleStart, nil)		effect:play()	else		FightMgr.battleStart()	end	end