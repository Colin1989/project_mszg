--region EnemyInfoView.lua
--Author : Administrator
--Date   : 2015/1/15
--此文件由[BabeLua]插件自动生成
------------------------------------------------------------------------ 作者：lewis-- 日期：2013-3-31-- 描述：当前玩家角色状态视图----------------------------------------------------------------------EnemyInfoView = class(RoleInfoView)function EnemyInfoView:ctor()	self.mRole = nil			--绑定的角色	self.mLifeIcon		= nil	--生命图标	self.mLifeBar		= nil	--生命槽	self.mLabels		= {}	--1生命，2攻击力，3速度	self.mOriginals		= {}	--原始数据		self.mSkillBtnTB	= {}endfunction EnemyInfoView:init(role,index,enemyInfo)	self.mRole = role	self.mRootView = LayerGameUI.mJJcUIRootView:getWidgetByName("jjc_uiindex"..index)    self:initExtraRoot()	local enemyiconFile = ModelPlayer.getRoleUpAppence(enemyInfo.type, enemyInfo.advanced_level).heroicon    local enemyicon = tolua.cast(self.mRootView:getChildByName("enemyicon"), "UIImageView")    enemyicon:loadTexture(enemyiconFile)	--self:createSkillBtn()	self:createAttrView()	    self:updateAll()end--更新全部function EnemyInfoView:updateAll()	self:updateAttr()	--self:updateSkill()end-----------------------------------------------------------------------------------------------------------基本数据--------------------------------------------------------------------------------------------------------------local function numberModifiedAction(node)	local scale = 1.428	node:stopAllActions()	node:setScale(0.6)    local arr = CCArray:create()		arr:addObject(CCEaseBackInOut:create(CCScaleBy:create(0.20, scale)))	arr:addObject(CCEaseBackInOut:create(CCScaleBy:create(0.07, 1 / scale)))	node:runAction(CCSequence:create(arr))end--创建生命,速度,攻击力视图function EnemyInfoView:createAttrView()    --LayerGameUI.mLifeLabel = mRootView:getWidgetByName("LabelAtlas_25_1")-- 生命值
	--tolua.cast(LayerGameUI.mLifeLabel, "UILabelAtlas")    	self.mLabels[1] 	= self.mRootView:getChildByName("enemy_life")-- 生命值    tolua.cast(self.mLabels[1] , "UILabel")	self.mLabels[2] 	= self.mRootView:getChildByName("enemy_atk")-- 速度    tolua.cast(self.mLabels[2] , "UILabel")	self.mLabels[3] 	= self.mRootView:getChildByName("enemy_speed")-- 攻击    tolua.cast(self.mLabels[3] , "UILabel")	self.mOriginals[1]	= 0	self.mOriginals[2]	= 0	self.mOriginals[3]	= 0		self.mLifeBar = self.mRootView:getChildByName("enemy_life_value"):getVirtualRenderer()	self.mLifeBar = tolua.cast(self.mLifeBar, "CCSprite")		--self.mLifeIcon = LayerGameUI.mRootView:getWidgetByName("ImageView_131"):getVirtualRenderer()	--self.mLifeIcon = tolua.cast(self.mLifeIcon, "CCSprite")end--更新主要属性 生命,速度,攻击力function EnemyInfoView:updateAttr()	local attribute = self.mRole.mData.mAttribute	for i = 1, 3 do		local cur = attribute:getByIndex(i)		local label = self.mLabels[i]		label:setText(string.format("%d", cur))		local color = attribute:getColor(i)		self:labelOnColor(label, color)		if cur ~= self.mOriginals[i] then			numberModifiedAction(label)			self.mOriginals[i] = cur		end	end		--生命条    local size = self.mLifeBar:getTexture():getContentSizeInPixels()	local percentage = attribute:getByName("life") / attribute:getMaxAttrWithName("life")	local length = size.width * percentage	self.mLifeBar:setTextureRect(CCRectMake(size.width - length, 0, length, size.height))	end-----------------------------------------------------------------------------------------------------------技能数据----------------------------------------------------------------------------------------------------------------创建技能按钮function EnemyInfoView:createSkillBtn()	local imgBg = tolua.cast(self.mRootView:getChildByName("enemy_skillbar_bg"), "UIImageView")	local skill = self.mRole.mData.mSkill	local tb = skill:getTB()	for key, value in pairs(tb) do		local pos = ccp(-240+94*key,0)		local btn = PlayerSkillBtn.new(false)		btn:init(imgBg, pos, value.id, value.level, key)        btn:setScale(0.5)		btn:setDelegate(self)		self.mSkillBtnTB[key] = btn	endend--更新技能function EnemyInfoView:updateSkill()	local skill = self.mRole.mData.mSkill	local tb = skill:getTB()	for key, value in pairs(tb) do		if value.isValid then			self.mSkillBtnTB[key]:update(value.progress, value.needCD)		end	endendfunction EnemyInfoView:initExtraRoot()    local  enemyinfo_extraroot = self.mRootView:getChildByName("enemyinfo_extraroot")    enemyinfo_extraroot:setVisible(false)    local  role_haskilled = self.mRootView:getChildByName("role_haskilled")    role_haskilled:setVisible(false)    local  role_unappence = self.mRootView:getChildByName("role_unappence")    role_unappence:setVisible(true) end function EnemyInfoView:beKilled()    local  enemyinfo_extraroot = self.mRootView:getChildByName("enemyinfo_extraroot")    enemyinfo_extraroot:setVisible(true)    local  role_haskilled = self.mRootView:getChildByName("role_haskilled")    role_haskilled:setVisible(true)    local  role_unappence = self.mRootView:getChildByName("role_unappence")    role_unappence:setVisible(false) end 
